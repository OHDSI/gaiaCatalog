#########
# GDSC ETL is performed in two steps: shell script to ETL data into postgres
# and then additional transformations with SQL in postGIS (if needed).
####

#########
# Step 1 - bash script (pseudo code)
####

# create directory structure and move into it
mkdir -p /data/tz_magu_dem_srtm/{download,etl} && cd /data/tz_magu_dem_srtm

# set update flag based on last update and update frequency
do_update=0 if date() < last_update + update_frequency else do_update = 1

# load raster into postGIS with:
    raster2pgsql -s 4326 -d -C -I -t auto tz_magu_dem_srtm.tif -F tz_magu_dem_srtm > load_raster.sql
psql <connection options> < load_raster.sql
rm load_raster.sql

# render raster tiles 
cd /data/tz_magu_dem_srtm/
gdal2tiles.py -ex --xyz -z 14-18 /data/tz_magu_dem_srtm/download/tz_magu_dem_srtm.tif /tiles/raster/tz_magu_dem_srtm
# Move into corrrect directory and create derivative directory in data package on osgeo
cd /data/tz_magu_dem_srtm/
mkdir -p derived

# Move into correct directory
cd /data/tz_magu_dem_srtm/


